# インストールガイド / Installation Guide

## 📦 Firefox へのインストール方法

### 方法1: 一時的なインストール（開発・テスト用）

**推奨**: まずはこの方法で動作を確認してください

1. **Firefox で about:debugging を開く**
   - アドレスバーに `about:debugging` と入力してEnter
   - または: メニュー → その他のツール → リモートデバッグ

2. **「このFirefox」を選択**
   - 左側のメニューから「このFirefox (This Firefox)」をクリック

3. **一時的なアドオンを読み込む**
   - 「一時的なアドオンを読み込む... (Load Temporary Add-on...)」ボタンをクリック
   - ファイル選択ダイアログが開きます

4. **manifest.jsonを選択**
   - この拡張機能のフォルダ内にある `manifest.json` ファイルを選択
   - 「開く」をクリック

5. **完了！**
   - 拡張機能が読み込まれ、ツールバーにアイコンが表示されます
   - 注意: この方法でインストールした拡張機能は、Firefox再起動時に削除されます

### 方法2: パッケージ化してインストール（永続的）

永続的にインストールするには、拡張機能に署名が必要です。

#### オプションA: 自己配布（web-ext sign）

```bash
# web-extをインストール（初回のみ）
npm install -g web-ext

# 署名を取得（AMOアカウントが必要）
web-ext sign --api-key=YOUR_API_KEY --api-secret=YOUR_API_SECRET
```

詳細: https://extensionworkshop.com/documentation/develop/getting-started-with-web-ext/

#### オプションB: Firefox Add-ons (AMO) で公開

1. https://addons.mozilla.org/developers/ でアカウント作成
2. 拡張機能をZIPにパッケージ化
3. AMOに提出してレビューを受ける
4. 承認後、公式ストアからインストール可能に

## 🚀 使い方

### 1. 拡張機能の起動

- Firefoxのツールバーにある 🚫 アイコンをクリック
- ポップアップウィンドウが開きます

### 2. NGドメインの登録

```
qiita.com
example.com
spam-site.net
```

- テキストエリアに、非表示にしたいドメインを **1行に1つ** 入力
- `http://` や `https://` は **不要** です
- ドメインの一部（サブドメインなし）を入力してください

### 3. 保存

- 「💾 保存」ボタンをクリック
- 成功メッセージが表示されます: `✓ 保存しました (3件のドメイン)`

### 4. 動作確認

- https://b.hatena.ne.jp/ を開く（または既に開いている場合はそのまま）
- NGドメインを含む記事が自動的に非表示になります
- **リロード不要**: 保存した瞬間に反映されます

### 5. クリア

- すべてのNGドメインを削除したい場合は「🗑️ クリア」ボタンをクリック
- 確認ダイアログが表示されます

## 🔍 動作確認方法

### テスト手順

1. **はてなブックマークにアクセス**
   ```
   https://b.hatena.ne.jp/
   ```

2. **現在表示されている記事を確認**
   - どんな記事が表示されているか確認

3. **NGドメインを登録**
   - 実際に表示されている記事のドメインをいくつか登録
   - 例: `qiita.com`, `zenn.dev` など

4. **即座に反映を確認**
   - 保存ボタンを押した瞬間、該当記事が消えるはず
   - ページのリロードは不要です

5. **ブラウザコンソールで確認**
   - F12キーを押してコンソールを開く
   - `[Hatebu Mute]` で始まるログメッセージを確認
   ```
   [Hatebu Mute] NGリスト: ["qiita.com", "zenn.dev"]
   [Hatebu Mute] 記事数: 50
   [Hatebu Mute] 15件の記事を非表示にしました
   ```

## 📋 フォルダ構成の確認

インストール前に、以下のファイルがすべて存在することを確認してください:

```
hatebu-mute-extension/
├── manifest.json       ✅ 必須
├── content.js          ✅ 必須
├── popup.html          ✅ 必須
├── popup.js            ✅ 必須
├── icon48.png          ✅ 必須
├── README.md           📄 説明書
└── INSTALL.md          📄 このファイル
```

## ⚠️ トラブルシューティング

### インストールできない

**エラー: "There was an error during installation"**
- manifest.json の構文エラーをチェック
- すべての必須ファイルが存在するか確認

**エラー: "Reading manifest: Error processing browser_specific_settings"**
- Firefox のバージョンが 109.0 以上であることを確認
- `about:support` で確認可能

### 拡張機能が動作しない

**症状: アイコンがツールバーに表示されない**
- `about:addons` で拡張機能が有効になっているか確認
- Firefox を再起動してみる

**症状: ポップアップが開かない**
- `about:debugging` → 「検証」でコンソールを確認
- エラーメッセージを確認

### フィルタリングが効かない

**症状: NGドメインを登録しても記事が消えない**

1. **NGドメインの形式を確認**
   - ❌ 間違い: `https://qiita.com`
   - ✅ 正しい: `qiita.com`

2. **ページ構造を確認**
   - F12 → Elements タブ
   - `li.js-keyboard-selectable-item` 要素が存在するか確認
   - はてなブックマークのHTML構造が変更されている可能性

3. **コンソールログを確認**
   - F12 → Console タブ
   - `[Hatebu Mute]` のログを確認
   - エラーメッセージがないか確認

4. **ストレージを確認**
   - F12 → Storage タブ → Extension Storage
   - `ngDomains` キーに値が保存されているか確認

### 保存が反映されない

**症状: 保存ボタンを押しても変化がない**

1. **ポップアップのステータスメッセージを確認**
   - 成功: `✓ 保存しました (N件のドメイン)`
   - 失敗: エラーメッセージが表示されるはず

2. **権限を確認**
   - `about:addons` → 拡張機能 → 権限タブ
   - 「データを保存」権限が有効になっているか確認

3. **ブラウザを再起動**
   - Firefox を完全に終了して再起動

## 🛠️ 開発者向け情報

### デバッグ方法

**コンテンツスクリプト (content.js) のデバッグ:**
1. はてなブックマークのページを開く
2. F12 を押してコンソールを開く
3. `[Hatebu Mute]` のログメッセージを確認

**ポップアップ (popup.js) のデバッグ:**
1. ポップアップを開く
2. ポップアップ上で右クリック → 「要素を調査」
3. 専用のコンソールが開きます

**バックグラウンド（この拡張機能では使用していません）:**
- `about:debugging` → 拡張機能 → 「検証」

### ファイルの編集

ファイルを編集した後:
1. `about:debugging` で「再読み込み」ボタンをクリック
2. または: Firefox を再起動（一時インストールの場合は再インストール必要）

### web-ext で開発

```bash
# 拡張機能フォルダで実行
web-ext run

# 自動リロード付きで実行
web-ext run --reload

# 特定のFirefoxプロファイルで実行
web-ext run --firefox-profile=your-profile
```

## 📞 サポート

問題が解決しない場合:
1. GitHub Issues でバグ報告
2. ブラウザコンソールのログをコピーして添付
3. Firefox のバージョン情報を記載
4. 再現手順を詳しく説明

## 🔒 プライバシーとセキュリティ

この拡張機能は:
- ✅ ローカルストレージのみ使用（外部送信なし）
- ✅ はてなブックマークのページのみアクセス
- ✅ 個人情報は収集しません
- ✅ オープンソース（コード公開）

安心してご利用ください！
